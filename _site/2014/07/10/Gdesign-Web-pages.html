<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta http-equiv="Cache-Control" content="no-transform">
        <title>Gdesign - Web Pages</title>
        <meta name="viewport" content="width=device-width">

        <!-- Latex support -->
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/pygments.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

        <!-- Logo -->
        <link rel="Shortcut Icon" href="/img/LP.png">

    </head>
    <body>
      <div class="site">
        <h1>Gdesign - Web Pages</h1>
<p class="meta">10 Jul 2014</p>

<div class="post">
<h2>概述</h2>

<p>本文主要讲 Gdesign 中的以下内容：</p>

<ul>
<li>前端 与 JavaScript</li>
<li>后端 与 数据库</li>
</ul>

<h2>1、前端页面</h2>

<p>在前端与 JavaScript 中，内容可以理解为1-4-1，具体为：</p>

<ul>
<li>1个 CSS</li>
<li>4个 jQuery 插件</li>
<li>1个 AJAX 操作</li>
</ul>

<p><strong>1.1 CSS 用于构建动态菜单栏：</strong></p>

<div class="highlight"><pre><code class="css"><span class="lineno">1</span> <span class="nc">.wrapper</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>  
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="nf">#menu</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>  
<span class="lineno">4</span> <span class="nf">#menu</span> <span class="nt">a</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> 
<span class="lineno">5</span> <span class="nf">#menu</span> <span class="nt">li</span><span class="nd">:first-child</span> <span class="nt">a</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> 
<span class="lineno">6</span> <span class="nf">#menu</span> <span class="nt">li</span><span class="nd">:last-child</span> <span class="nt">a</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> 
<span class="lineno">7</span> <span class="nf">#menu</span> <span class="nt">a</span><span class="nd">:hover</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>  
<span class="lineno">8</span> <span class="nf">#menu</span> <span class="nt">a</span><span class="nd">:active</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>  
</code></pre></div>

<p><strong>1.2 jQuery 插件的使用</strong></p>

<p>4个 jQuery 插件为：omniWindows、morris、fotorama 与 zebra_datepicker。</p>

<ul>
<li>omniWindows ： 登陆框弹窗插件</li>
</ul>

<p>在调用 omniWindows 的 HTML 中，需要声明 DIV 的 class 为 <code>ow-overlay ow-closed</code> 与 <code>window ow-closed</code> 。
并在 <code>window ow-closed</code> 中构建需要的弹窗。</p>

<p>在使用中，omniWindows 对应的 CSS 属性写在 <code>index.css</code> 中，对应的 HTML 调用代码如下。</p>

<div class="highlight"><pre><code class="html"><span class="lineno">1</span> <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ow-overlay ow-closed&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="lineno">2</span> <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;window ow-closed&quot;</span><span class="nt">&gt;</span>
<span class="lineno">3</span> ... //想要调用的内容
<span class="lineno">4</span> <span class="nt">&lt;/div&gt;</span>
</code></pre></div>

<ul>
<li>Morris ： 曲线绘制插件</li>
</ul>

<p>在调用 Morris 时，包含 Morris 的 JS 文件，这里可以根据服务器环境选择官网的做法，也可以直接下载 JS 文件。</p>

<p><a href="http://morrisjs.github.io/morris.js/">Morris官网</a> 有很不错的入门教程，想要深入了解更多的定制信息，则需要进入顶部菜单栏的分页中。</p>

<div class="highlight"><pre><code class="html"><span class="lineno">1</span> <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;css/morris.css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="nt">&gt;</span>
<span class="lineno">2</span> <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/jquery-1.8.2.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="lineno">3</span> <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/morris.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>

<p>调用 Morris 代码如下。</p>

<div class="highlight"><pre><code class="js"><span class="lineno"> 1</span> <span class="k">new</span> <span class="nx">Morris</span><span class="p">.</span><span class="nx">Line</span><span class="p">({</span>
<span class="lineno"> 2</span>      <span class="nx">element</span><span class="o">:</span> <span class="s1">&#39;desktop&#39;</span><span class="p">,</span>
<span class="lineno"> 3</span>      <span class="nx">data</span><span class="o">:</span> <span class="nx">data_json</span><span class="p">,</span> 
<span class="lineno"> 4</span>    
<span class="lineno"> 5</span>      <span class="nx">xkey</span><span class="o">:</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span>
<span class="lineno"> 6</span>      <span class="nx">ymax</span><span class="o">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
<span class="lineno"> 7</span>      
<span class="lineno"> 8</span>      <span class="nx">ykeys</span><span class="o">:</span> <span class="nx">ykey_arr</span><span class="p">,</span>
<span class="lineno"> 9</span>      <span class="nx">labels</span><span class="o">:</span> <span class="nx">label_arr</span><span class="p">,</span>
<span class="lineno">10</span> 
<span class="lineno">11</span>      <span class="nx">lineColors</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;#000&#39;</span><span class="p">],</span>
<span class="lineno">12</span>      <span class="nx">pointFillColors</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;#F00&#39;</span><span class="p">],</span>
<span class="lineno">13</span>  <span class="p">});</span>
</code></pre></div>

<ul>
<li>Fotorama : 图片画廊插件</li>
</ul>

<p><a href="http://fotorama.io/">Fotarama官网</a> 百度关键词 fotoroma 就能找到，较好的插件官网上总有很多调用教程和 demo，而且还有许多深入文档，学习 fotorama 就需要学习很多的定制信息（<a href="http://fotorama.io/customize/">Customize</a>）。</p>

<p>调用一般的 JS 文件，步骤都是：添加引用、调用。</p>

<p>声明代码如下：</p>

<div class="highlight"><pre><code class="html"><span class="lineno">1</span> <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/jquery-1.8.2.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="lineno">2</span> <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;css/fotorama.css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="nt">&gt;</span>
<span class="lineno">3</span> <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/fotorama.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>

<p>调用代码如下：</p>

<div class="highlight"><pre><code class="js"><span class="lineno">1</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.fotorama&quot;</span><span class="p">).</span><span class="nx">fotorama</span><span class="p">({</span>
<span class="lineno">2</span>       <span class="nx">width</span><span class="o">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span>
<span class="lineno">3</span>       <span class="nx">height</span><span class="o">:</span> <span class="s1">&#39;68%&#39;</span><span class="p">,</span>
<span class="lineno">4</span>       <span class="nx">fit</span><span class="o">:</span> <span class="s1">&#39;cover&#39;</span><span class="p">,</span>
<span class="lineno">5</span>       <span class="nx">allowfullscreen</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">6</span>       <span class="nx">nav</span><span class="o">:</span> <span class="s1">&#39;thumbs&#39;</span><span class="p">,</span>
<span class="lineno">7</span>   <span class="p">});</span>
</code></pre></div>

<p>在调用中需要注意的是，由于 fotorama 是首次构建 CSS 时创建的，所以不接受动态创建的 DIV 直接声明使用，而需要使用 innerHTML 来创建，否则无法获取到对应图片信息。</p>

<div class="highlight"><pre><code class="js"><span class="lineno">1</span> <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data_json</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">2</span>   <span class="nx">img_box</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s1">&#39;&lt;img src=&quot;&#39;</span> <span class="o">+</span> <span class="nx">data_json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">sdir</span> <span class="o">+</span> <span class="s1">&#39;&quot;\</span>
<span class="lineno">3</span> <span class="s1"> data-caption=&quot;&#39;</span> <span class="o">+</span> <span class="nx">data_json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">time</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span>
<span class="lineno">4</span>   <span class="p">}</span>
</code></pre></div>

<ul>
<li>zebra_datepicker：日期选择器</li>
</ul>

<p><a href="http://stefangabos.ro/jquery/zebra-datepicker/">zebra_datepicker官网</a>，zebre_datepicker 是基于 raphael 在定制的一套日期选择器。</p>

<p>声明代码如下：</p>

<div class="highlight"><pre><code class="html"><span class="lineno">1</span> <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;css/fotorama.css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="nt">&gt;</span>
<span class="lineno">2</span> <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/raphael-2.1.0.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="lineno">3</span> <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/zebra_datepicker.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>

<p>调用代码如下：</p>

<div class="highlight"><pre><code class="js"><span class="lineno"> 1</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#datepicker&#39;</span><span class="p">).</span><span class="nx">Zebra_DatePicker</span><span class="p">({</span>
<span class="lineno"> 2</span>      <span class="nx">disabled_dates</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;* * * *&#39;</span><span class="p">],</span>
<span class="lineno"> 3</span>      <span class="nx">enabled_dates</span><span class="o">:</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">ret_json</span><span class="p">),</span>
<span class="lineno"> 4</span>      <span class="nx">onSelect</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 5</span>          <span class="nx">dvar</span> <span class="o">=</span> <span class="nx">date</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span>          <span class="kd">var</span> <span class="nx">td</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">Format</span><span class="p">(</span><span class="s2">&quot;yyyy-MM-dd&quot;</span><span class="p">)</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>          <span class="k">if</span> <span class="p">(</span><span class="nx">dvar</span> <span class="o">!=</span> <span class="nx">td</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">10</span>              <span class="nx">remove_status</span><span class="p">()</span>
<span class="lineno">11</span>          <span class="p">}</span>
<span class="lineno">12</span> 
<span class="lineno">13</span>          <span class="k">if</span> <span class="p">(</span><span class="nx">tbvar</span> <span class="o">==</span> <span class="s2">&quot;camer&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">14</span>              <span class="nx">show_img</span><span class="p">(</span><span class="nx">tbvar</span><span class="p">,</span> <span class="nx">dvar</span><span class="p">)</span>
<span class="lineno">15</span>          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="lineno">16</span>              <span class="nx">remove_status</span><span class="p">()</span>
<span class="lineno">17</span>              <span class="nx">show_data</span><span class="p">(</span><span class="nx">tbvar</span><span class="p">,</span> <span class="nx">dvar</span><span class="p">)</span>
<span class="lineno">18</span>          <span class="p">}</span>
<span class="lineno">19</span>      <span class="p">}</span>
<span class="lineno">20</span>  <span class="p">});</span>
</code></pre></div>
<div class="highlight"><pre><code class="text language-text" data-lang="text">TIPS: zebra_datepicker 的日期格式需为 JSON 格式。
</code></pre></div>
<p><strong>1.3 AJAX 操作</strong></p>

<p>实现 AJAX ，数据传输的主要流程为： 前端页面操作、后端数据传输 与 数据库数据获取。</p>

<ul>
<li>前端页面操作</li>
</ul>

<p>在前端页面中，主要通过构建菜单栏操作函数实现。</p>

<div class="highlight"><pre><code class="js"><span class="lineno">1</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#menu&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span>
<span class="lineno">2</span> <span class="p">});</span>
</code></pre></div>

<p>AJAX 使用的 API 主要通过使用 getdb、setdb 实现获取数据、设置数据。</p>

<div class="highlight"><pre><code class="js"><span class="kd">function</span> <span class="nx">getdb</span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">day</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div>

<p>在 Gdesign.js 中，在 getdb、setdb 外还封装了一层调用函数，实现对不同的菜单的相应，调用三个函数原型如下：</p>

<div class="highlight"><pre><code class="js"><span class="lineno">1</span> <span class="kd">function</span> <span class="nx">show_data</span><span class="p">(</span><span class="nx">tbvar</span><span class="p">,</span> <span class="nx">day</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="lineno">2</span> <span class="kd">function</span> <span class="nx">show_img</span><span class="p">(</span><span class="nx">tbvar</span><span class="p">,</span> <span class="nx">day</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="lineno">3</span> <span class="kd">function</span> <span class="nx">controls</span><span class="p">(</span><span class="nx">tbvar</span><span class="p">,</span> <span class="nx">gdatas</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</code></pre></div>

<p>参数 <code>tbvar</code> 即为 &quot;table variable&quot; 的意思，对应于不同的菜单 ID。<br>
参数 <code>day</code> 即为当前日期，若使用 zebra_picker 筛选出不同的的可选日期。<br>
参数 <code>gdatas</code> 本质上就是字符串  &quot;getdatas&quot; 。</p>

<p>getdb 的 AJAX 操作如下，在操作中仅使用 GET 操作，通过 tbvar -&gt; table 的不同参数传递，实现对不同 PHP 文件的选择。相关的 AJAX 学习，可以参考 <a href="http://www.w3school.com.cn/ajax/index.asp">W3CSchool AJAX 教程</a>。</p>

<div class="highlight"><pre><code class="js"><span class="lineno"> 1</span> <span class="kd">function</span> <span class="nx">getdb</span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">day</span><span class="p">)</span> <span class="p">{</span> 
<span class="lineno"> 2</span>  <span class="nx">xmlHttp</span><span class="o">=</span><span class="nx">GetXmlHttpObject</span><span class="p">()</span>
<span class="lineno"> 3</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">xmlHttp</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 4</span>      <span class="nx">alert</span> <span class="p">(</span><span class="s2">&quot;Browser does not support HTTP Request&quot;</span><span class="p">)</span>
<span class="lineno"> 5</span>      <span class="k">return</span>
<span class="lineno"> 6</span>  <span class="p">}</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span>  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;php/&quot;</span> <span class="o">+</span> <span class="nx">table</span> <span class="o">+</span> <span class="s2">&quot;.php?req=&quot;</span> <span class="o">+</span> <span class="nx">day</span>
<span class="lineno"> 9</span>  <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">onreadystatechange</span><span class="o">=</span><span class="nx">retValues</span>
<span class="lineno">10</span>  <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
<span class="lineno">11</span>  <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="lineno">12</span> <span class="p">}</span>
</code></pre></div>

<ul>
<li>后端数据传输</li>
</ul>

<p>在后端数据传输中，主要依靠 PHP 对数据库实现操作。在 PHP 中，其核心在于参数的获取 以及连接数据库、操作数据库。</p>

<div class="highlight"><pre><code class="js"><span class="lineno"> 1</span> <span class="nx">$req</span><span class="o">=</span><span class="nx">$_GET</span><span class="p">[</span><span class="s2">&quot;req&quot;</span><span class="p">];</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$con</span><span class="p">)</span>
<span class="lineno"> 4</span> <span class="p">{</span>
<span class="lineno"> 5</span> <span class="nx">die</span><span class="p">(</span><span class="s1">&#39;Could not connect: &#39;</span> <span class="p">.</span> <span class="nx">mysql_error</span><span class="p">());</span>
<span class="lineno"> 6</span> <span class="p">}</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="nx">$sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="lineno"> 9</span> <span class="nx">$result</span> <span class="o">=</span> <span class="nx">mysql_query</span><span class="p">(</span><span class="nx">$sql</span><span class="p">);</span>
<span class="lineno">10</span> <span class="p">...</span>
</code></pre></div>

<p>获取后的数据以 <code>echo</code> 的方式打印在页面上，而 js 文件通过 <code>GetXmlHttpObject</code> 来获取页面上的数据。</p>

<ul>
<li>数据库数据获取</li>
</ul>

<p>详见论文3.5节。</p>

<p>&copy; 2014 plinx</p>

</div>

      </div>
    </body>
</html>
